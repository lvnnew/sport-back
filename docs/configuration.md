
# Configuration

Project takes configurations from two places: from config files in `projectRoot/config` folder and from environment variables.

Environment variables takes precedence.

## Loading from files

There is two files, configuration will be loaded from: `default.json` and `${ENV}.json` where `${ENV}` is `ENV` environment variable or `dev` if `ENV` environment variable is not set.

If both files exists they will be merged. `${ENV}.json` takes precedence.

> **_WARNING:_**  `default.json` stored in git so do not put secret information in there (database credentials, passwords, etc.)

## Configuration variables

| Key in file                         | Environment                          | Type   | Required | Default value                                 | Need for                                                                                                                                  |
| ----------------------------------- | ------------------------------------ | ------ | -------- | --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| adm.jwt.secret                      | ADM_JWT_SECRET                       | string | false    | admSecret                                     | Секрет для подписи JWT-токенов приложения админки                                                                                         |
| admin.recaptcha.requiredScore       | ADMIN_RECAPTCHA_REQUIRED_SCORE       | float  | false    | 0.7                                           | Требуемый уровень доверия к пользователю                                                                                                  |
| admin.recaptcha.secretKey           | ADMIN_RECAPTCHA_SECRET_KEY           | string | false    |                                               | Секретный токен рекапчи приложения админки                                                                                                |
| admin.ui.url                        | ADMIN_UI_URL                         | string | false    | http://localhost:8080                         | Урл административного интерфейса (без конечного слеша)                                                                                    |
| app.environment                     | APP_ENVIRONMENT                      | string | true     | dev                                           | Название окружения                                                                                                                        |
| app.jwt.secret                      | APP_JWT_SECRET                       | string | false    | appSecret                                     | Секрет для подписи JWT-токенов приложения пользователей                                                                                   |
| app.name                            | APP_NAME                             | string | true     | mtbase                                        | Техническое название приложения                                                                                                           |
| app.title                           | APP_TITLE                            | string | false    | Meta Template Base                            | Человеческое название приложения                                                                                                          |
| app.ui.url                          | APP_UI_URL                           | string | false    | http://localhost:4000                         | Урл интерфейса конечного пользователя (без конечного слеша)                                                                               |
| authorization.backendChecks.enabled | AUTHORIZATION_BACKEND_CHECKS_ENABLED | bool   | false    | false                                         | Проверка авторизации на бекенде включены                                                                                                  |
| bootstrap.enabled                   | BOOTSTRAP_ENABLED                    | bool   | false    | false                                         | Подготавливать окружеине при запуске                                                                                                      |
| customer.recaptcha.requiredScore    | CUSTOMER_RECAPTCHA_REQUIRED_SCORE    | string | false    | 0.7                                           | Требуемый уровень доверия к пользователю                                                                                                  |
| customer.recaptcha.secretKey        | CUSTOMER_RECAPTCHA_SECRET_KEY        | string | false    |                                               | Секретный токен рекапчи приложения пользователя                                                                                           |
| database.main.migration.uri         | DATABASE_MAIN_MIGRATION_URI          | string | true     | postgresql://postgres:password@localhost:5432 | Строка подключения к основной базе для миграций (должна быть прямой строкой подключения к бд минуя pgbouncer, если он используется)       |
| database.main.readOnly.enabled      | DATABASE_MAIN_READ_ONLY_ENABLED      | bool   | true     | false                                         | Включена ли работа с запросами на чтение через отдельное подключение                                                                      |
| database.main.readOnly.uri          | DATABASE_MAIN_READ_ONLY_URI          | string | false    | postgresql://postgres:password@localhost:5432 | Строка подключения к основной базе только для чтения                                                                                      |
| database.main.write.uri             | DATABASE_MAIN_WRITE_URI              | string | true     | postgresql://postgres:password@localhost:5432 | Строка подключения к основной базе данных для записи                                                                                      |
| es.cloudId                          | ES_CLOUD_ID                          | string | false    |                                               | Идентификатор аккаунта в облачном сервисе ElasticSearch                                                                                   |
| es.enabled                          | ES_ENABLED                           | bool   | false    | false                                         | Эластик включен                                                                                                                           |
| es.node                             | ES_NODE                              | string | false    | http://localhost:9200                         | Нода эластика                                                                                                                             |
| es.password                         | ES_PASSWORD                          | string | false    |                                               | Пароль для авторизации в облачном сервисе ElasticSearch                                                                                   |
| es.tls.rejectUnauthorized           | ES_TLS_REJECT_UNAUTHORIZED           | bool   | false    | false                                         | Запрещать невалидный ssl сертификат                                                                                                       |
| es.username                         | ES_USERNAME                          | string | false    |                                               | Пользователь для авторизации в облачном сервисе ElasticSearch                                                                             |
| graphql.playground.enabled          | GRAPHQL_PLAYGROUND_ENABLED           | bool   | false    | true                                          | Включение graphql playground (true | false)                                                                                               |
| kafka.auth.enabled                  | KAFKA_AUTH_ENABLED                   | bool   | true     | true                                          | Включена проверка аутентификации                                                                                                          |
| kafka.brokers                       | KAFKA_BROKERS                        | string | false    | localhost:29092;localhost:29094               | Список kafka блокеров                                                                                                                     |
| kafka.enabled                       | KAFKA_ENABLED                        | bool   | false    | false                                         | Кафка включена                                                                                                                            |
| kafka.password                      | KAFKA_PASSWORD                       | string | false    |                                               | Пароль доступа в kafka                                                                                                                    |
| kafka.queue.acks                    | KAFKA_QUEUE_ACKS                     | int    | false    | 1                                             | `-1`(all) все несинхронизированные реплики должны подтвердить (по умолчанию), `0` нет подтверждений, `1` только ждет подтверждения лидера |
| kafka.queue.defaultRetryTime        | KAFKA_QUEUE_DEFAULT_RETRY_TIME       | int    | false    | 20000                                         | Время паузы после первой ошибки, например 20000 мс, потом оно увеличывается экспоненциально с мультипликатором 1.5                        |
| kafka.queue.maxAttemptsSize         | KAFKA_QUEUE_MAX_ATTEMPTS_SIZE        | int    | false    | 10                                            | Максимальное количество попыток обработки ошибки на сообщение                                                                             |
| kafka.queue.stackSize               | KAFKA_QUEUE_STACK_SIZE               | int    | false    | 3                                             | Количество сообщений, обрабатываемых параллельно                                                                                          |
| kafka.queue.supportedVersion        | KAFKA_QUEUE_SUPPORTED_VERSION        | string | false    | 1;2                                           | Поддерживаемые версии сообщения                                                                                                           |
| kafka.queue.waitingInterruptTime    | KAFKA_QUEUE_WAITING_INTERRUPT_TIME   | int    | false    | 60000                                         | Время паузы в очереди ожидания, когда она прошла все сообщения, это чтобы она не крутила сообщения покругу без остановки                  |
| kafka.ssl.enabled                   | KAFKA_SSL_ENABLED                    | bool   | true     | true                                          | Включена работа по ssl                                                                                                                    |
| kafka.ssl.rejectUnauthorized        | KAFKA_SSL_REJECT_UNAUTHORIZED        | bool   | false    | false                                         | Запрещать невалидный ssl сертификат                                                                                                       |
| kafka.username                      | KAFKA_USERNAME                       | string | false    |                                               | Username доступа в kafka                                                                                                                  |
| logs.format                         | LOGS_FORMAT                          | string | false    | plain                                         | Формат логов (plain | json)                                                                                                               |
| loki.url                            | LOKI_URL                             | string | false    |                                               | Урл для доступа в Loki. Используется для запроса бизнес-логов                                                                             |
| s3.accessKeyId                      | S3_ACCESS_KEY_ID                     | string | true     |                                               | Идентификатор доступа для авторизации в S3                                                                                                |
| s3.bucket.emailFiles                | S3_BUCKET_EMAIL_FILES                | string | true     |                                               | Имя бакета для хранения файлов, отправленных на почту                                                                                     |
| s3.bucket.tmpFilesToDownload        | S3_BUCKET_TMP_FILES_TO_DOWNLOAD      | string | true     |                                               | Имя бакета для хранения временных файлов, созданных для скачивания пользователями                                                         |
| s3.endpoint                         | S3_ENDPOINT                          | string | true     | s3.eu-central-1.wasabisys.com                 | Эндпоинт S3, который использует бекенд                                                                                                    |
| s3.region                           | S3_REGION                            | string | true     | eu-central-1                                  | Идентификатор доступа для авторизации в S3                                                                                                |
| s3.secretAccessKey                  | S3_SECRET_ACCESS_KEY                 | string | true     |                                               | Секретный ключ для авторизации в S3                                                                                                       |
| smtp.from                           | SMTP_FROM                            | string | false    |                                               | Почтовый адрес, от имени которого следует отправлять письма                                                                               |
| smtp.host                           | SMTP_HOST                            | string | false    |                                               | Хост почтового сервера                                                                                                                    |
| smtp.pass                           | SMTP_PASS                            | string | false    |                                               | Пароль пользователя для авторизации на почтовом сервере                                                                                   |
| smtp.port                           | SMTP_PORT                            | int    | false    |                                               | Порт почтового сервера                                                                                                                    |
| smtp.user                           | SMTP_USER                            | string | false    |                                               | Имя пользователя для авторизации на почтовом сервере                                                                                      |
