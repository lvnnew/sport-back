generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fieldReference", "metrics", "extendedWhereUnique"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_MAIN_WRITE_URI")
}

model AggregateTracking {
	id	Int	@default(autoincrement())	@id
	entityTypeId	String
	entityType	Entity	@relation("From-AggregateTracking.entityType", fields: [entityTypeId], references: [id])
	entityId	String
	lastAggregatesComputed	DateTime
	lastAggregatesScheduled	DateTime?
	lastEntityUpdate	DateTime
	aggregateVersion	Int
	@@unique([entityTypeId, entityId])
}


model AppRefreshToken {
	id	Int	@default(autoincrement())	@id
	search	String?
	create	DateTime
	userId	Int
	user	User	@relation("From-AppRefreshToken.user", fields: [userId], references: [id])
	token	String
}


model Language {
	id	String	@id
	search	String?
	title	String?
	mailingMessageLanguages	MailingMessage[]	@relation("From-MailingMessage.language")
	managerLanguages	Manager[]	@relation("From-Manager.language")
	messageTemplateLangVariantLanguages	MessageTemplateLangVariant[]	@relation("From-MessageTemplateLangVariant.language")
}


model Stat {
	id	String	@id
	search	String?
	updated	DateTime?
	helloCount	Int?
}


model Tag {
	id	Int	@default(autoincrement())	@id
	search	String?
	comment	String?
}


model AdmRefreshToken {
	id	Int	@default(autoincrement())	@id
	search	String?
	create	DateTime
	managerId	Int
	manager	Manager	@relation("From-AdmRefreshToken.manager", fields: [managerId], references: [id])
	token	String
}


model AuditLog {
	id	Int	@default(autoincrement())	@id
	search	String?
	date	DateTime
	title	String
	success	Boolean?
	error	String?
	entityTypeId	String
	entityType	Entity	@relation("From-AuditLog.entityType", fields: [entityTypeId], references: [id])
	entityId	String
	actionTypeId	String
	actionType	AuditLogActionType	@relation("From-AuditLog.actionType", fields: [actionTypeId], references: [id])
	managerId	Int?
	manager	Manager?	@relation("From-AuditLog.manager", fields: [managerId], references: [id])
	userId	Int?
	user	User?	@relation("From-AuditLog.user", fields: [userId], references: [id])
	foreign	Boolean?
	foreignEntityType	String?
	foreignEntityId	String?
	actionData	String?
}


model Delegation {
	id	Int	@default(autoincrement())	@id
	search	String?
	fromId	Int
	from	Manager	@relation("From-Delegation.from", fields: [fromId], references: [id])
	toId	Int
	to	Manager	@relation("From-Delegation.to", fields: [toId], references: [id])
	expiresAt	DateTime?	@db.Date
	active	Boolean
}


model AutogenerationHistoryEntry {
	id	Int	@default(autoincrement())	@id
	search	String?
	date	DateTime
	originalEntityType	String
	originalEntityId	String
	autogenerationRuleId	String
	autogenerationRule	AutogenerationRule	@relation("From-AutogenerationHistoryEntry.autogenerationRule", fields: [autogenerationRuleId], references: [id])
	version	DateTime	@db.Date
	errorOccurred	Boolean
	error	String?
}


model ManagerLogin {
	id	Int	@default(autoincrement())	@id
	search	String?
	login	String
	passwordHash	String
	emailVerified	Boolean
	initialPasswordChanged	Boolean
	locked	Boolean
	managerId	Int
	manager	Manager	@relation("From-ManagerLogin.manager", fields: [managerId], references: [id])
	@@unique([login])
}


model AppLogin {
	id	Int	@default(autoincrement())	@id
	search	String?
	login	String
	passwordHash	String
	userId	Int
	user	User	@relation("From-AppLogin.user", fields: [userId], references: [id])
	@@unique([login])
}


model Manager {
	id	Int	@default(autoincrement())	@id
	search	String?
	title	String?
	lastName	String
	firstName	String
	languageId	String?
	language	Language?	@relation("From-Manager.language", fields: [languageId], references: [id])
	email	String
	phone	String?
	photoId	Int?
	photo	File?	@relation("From-Manager.photo", fields: [photoId], references: [id])
	telegramLogin	String?
	unitId	Int?
	unit	Unit?	@relation("From-Manager.unit", fields: [unitId], references: [id])
	headOfUnit	Boolean
	active	Boolean
	tenantId	Int?
	tenant	Tenant?	@relation("From-Manager.tenant", fields: [tenantId], references: [id])
	admRefreshTokenManagers	AdmRefreshToken[]	@relation("From-AdmRefreshToken.manager")
	auditLogManagers	AuditLog[]	@relation("From-AuditLog.manager")
	delegationFroms	Delegation[]	@relation("From-Delegation.from")
	delegationTos	Delegation[]	@relation("From-Delegation.to")
	managerLoginManagers	ManagerLogin[]	@relation("From-ManagerLogin.manager")
	managersToPermissionManagers	ManagersToPermission[]	@relation("From-ManagersToPermission.manager")
	managersToRoleManagers	ManagersToRole[]	@relation("From-ManagersToRole.manager")
	@@unique([email])
}


model Unit {
	id	Int	@default(autoincrement())	@id
	search	String?
	title	String
	parentId	Int?
	parent	Unit?	@relation("From-Unit.parent", fields: [parentId], references: [id])
	managerUnits	Manager[]	@relation("From-Manager.unit")
	unitParents	Unit[]	@relation("From-Unit.parent")
}


model User {
	id	Int	@default(autoincrement())	@id
	search	String?
	title	String?
	lastname	String
	firstname	String
	email	String
	tenantId	Int?
	tenant	Tenant?	@relation("From-User.tenant", fields: [tenantId], references: [id])
	appLoginUsers	AppLogin[]	@relation("From-AppLogin.user")
	appRefreshTokenUsers	AppRefreshToken[]	@relation("From-AppRefreshToken.user")
	auditLogUsers	AuditLog[]	@relation("From-AuditLog.user")
}


model AutogenerationRule {
	id	String	@id
	search	String?
	title	String
	version	DateTime?	@db.Date
	originalEntityType	String
	generatingEntityType	String
	originalEntityFilter	String
	generatingEntityConstructionRules	String
	ignoreVersionOnHistory	Boolean
	autogenerationHistoryEntryAutogenerationRules	AutogenerationHistoryEntry[]	@relation("From-AutogenerationHistoryEntry.autogenerationRule")
}


model Permission {
	id	String	@id
	search	String?
	title	String?
	managersToPermissionPermissions	ManagersToPermission[]	@relation("From-ManagersToPermission.permission")
	rolesToPermissionPermissions	RolesToPermission[]	@relation("From-RolesToPermission.permission")
}


model ManagersToPermission {
	id	Int	@default(autoincrement())	@id
	search	String?
	managerId	Int
	manager	Manager	@relation("From-ManagersToPermission.manager", fields: [managerId], references: [id])
	permissionId	String
	permission	Permission	@relation("From-ManagersToPermission.permission", fields: [permissionId], references: [id])
	expiresAt	DateTime?	@db.Date
}


model RolesToPermission {
	id	Int	@default(autoincrement())	@id
	search	String?
	roleId	String
	role	Role	@relation("From-RolesToPermission.role", fields: [roleId], references: [id])
	permissionId	String
	permission	Permission	@relation("From-RolesToPermission.permission", fields: [permissionId], references: [id])
	@@unique([roleId, permissionId])
}


model MailingCampaign {
	id	Int	@default(autoincrement())	@id
	search	String?
	title	String
	mailingTypeId	String
	mailingType	MailingType	@relation("From-MailingCampaign.mailingType", fields: [mailingTypeId], references: [id])
	priority	Int
	date	DateTime?	@db.Date
	mailingCampaignStatusId	String?
	mailingCampaignStatus	MailingCampaignStatus?	@relation("From-MailingCampaign.mailingCampaignStatus", fields: [mailingCampaignStatusId], references: [id])
	messageTemplateId	String
	messageTemplate	MessageTemplate	@relation("From-MailingCampaign.messageTemplate", fields: [messageTemplateId], references: [id])
	mailingMessageMailingCampaigns	MailingMessage[]	@relation("From-MailingMessage.mailingCampaign")
}


model Role {
	id	String	@id
	search	String?
	title	String?
	hasAllPermissions	Boolean
	allTenantsAvailable	Boolean
	managersToRoleRoles	ManagersToRole[]	@relation("From-ManagersToRole.role")
	rolesToPermissionRoles	RolesToPermission[]	@relation("From-RolesToPermission.role")
}


model ManagersToRole {
	id	Int	@default(autoincrement())	@id
	search	String?
	managerId	Int
	manager	Manager	@relation("From-ManagersToRole.manager", fields: [managerId], references: [id])
	roleId	String
	role	Role	@relation("From-ManagersToRole.role", fields: [roleId], references: [id])
	expiresAt	DateTime?	@db.Date
	@@unique([managerId, roleId, expiresAt])
}


model MailingMessage {
	id	Int	@default(autoincrement())	@id
	search	String?
	mailingCampaignId	Int
	mailingCampaign	MailingCampaign	@relation("From-MailingMessage.mailingCampaign", fields: [mailingCampaignId], references: [id])
	templateId	String
	template	MessageTemplate	@relation("From-MailingMessage.template", fields: [templateId], references: [id])
	languageId	String
	language	Language	@relation("From-MailingMessage.language", fields: [languageId], references: [id])
	to	String
	locals	String
	localsHash	String
	priority	Int
	dateCreated	DateTime
	dateSent	DateTime?
	error	String?
	html	String?
	text	String?
	uniqueKey	String?
	subject	String?
	mailingMessageStatusId	String
	mailingMessageStatus	MailingMessageStatus	@relation("From-MailingMessage.mailingMessageStatus", fields: [mailingMessageStatusId], references: [id])
	messageTemplateLangVariantId	Int
	messageTemplateLangVariant	MessageTemplateLangVariant	@relation("From-MailingMessage.messageTemplateLangVariant", fields: [messageTemplateLangVariantId], references: [id])
	@@unique([mailingCampaignId, to, uniqueKey])
}


model MailingCampaignStatus {
	id	String	@id
	search	String?
	title	String
	mailingCampaignMailingCampaignStatuses	MailingCampaign[]	@relation("From-MailingCampaign.mailingCampaignStatus")
}


model MailingMessageStatus {
	id	String	@id
	search	String?
	title	String?
	final	Boolean
	mailingMessageMailingMessageStatuses	MailingMessage[]	@relation("From-MailingMessage.mailingMessageStatus")
}


model TemplateStyle {
	id	Int	@default(autoincrement())	@id
	search	String?
	title	String
	style	String
	messageTemplateTemplateStyles	MessageTemplate[]	@relation("From-MessageTemplate.templateStyle")
}


model Entity {
	id	String	@id
	search	String?
	title	String?
	aggregateTrackingEntityTypes	AggregateTracking[]	@relation("From-AggregateTracking.entityType")
	auditLogEntityTypes	AuditLog[]	@relation("From-AuditLog.entityType")
}


model Tenant {
	id	Int	@default(autoincrement())	@id
	search	String?
	title	String?
	utcOffset	Int	@default(0)
	managerTenants	Manager[]	@relation("From-Manager.tenant")
	userTenants	User[]	@relation("From-User.tenant")
}


model MailingType {
	id	String	@id
	search	String?
	title	String
	mailingCampaignMailingTypes	MailingCampaign[]	@relation("From-MailingCampaign.mailingType")
}


model AuditLogActionType {
	id	String	@id
	search	String?
	title	String?
	auditLogActionTypes	AuditLog[]	@relation("From-AuditLog.actionType")
}


model MessageType {
	id	String	@id
	search	String?
	title	String
	description	String?
	messageTemplateMessageTypes	MessageTemplate[]	@relation("From-MessageTemplate.messageType")
}


model File {
	id	Int	@default(autoincrement())	@id
	search	String?
	originalName	String
	url	String
	mimetype	String
	s3Key	String
	eTag	String
	managerPhotos	Manager[]	@relation("From-Manager.photo")
}


model MessageTemplate {
	id	String	@id
	search	String?
	title	String
	secretData	Boolean
	messageTypeId	String
	messageType	MessageType	@relation("From-MessageTemplate.messageType", fields: [messageTypeId], references: [id])
	dataExample	String?
	templateStyleId	Int?
	templateStyle	TemplateStyle?	@relation("From-MessageTemplate.templateStyle", fields: [templateStyleId], references: [id])
	mailingCampaignMessageTemplates	MailingCampaign[]	@relation("From-MailingCampaign.messageTemplate")
	mailingMessageTemplates	MailingMessage[]	@relation("From-MailingMessage.template")
	messageTemplateLangVariantMessageTemplates	MessageTemplateLangVariant[]	@relation("From-MessageTemplateLangVariant.messageTemplate")
}


model MessageTemplateLangVariant {
	id	Int	@default(autoincrement())	@id
	search	String?
	title	String?
	subjectTemplate	String
	bodyTemplate	String
	messageTemplateId	String
	messageTemplate	MessageTemplate	@relation("From-MessageTemplateLangVariant.messageTemplate", fields: [messageTemplateId], references: [id])
	languageId	String
	language	Language	@relation("From-MessageTemplateLangVariant.language", fields: [languageId], references: [id])
	additionalStyle	String?
	mailingMessageMessageTemplateLangVariants	MailingMessage[]	@relation("From-MailingMessage.messageTemplateLangVariant")
	@@unique([messageTemplateId, languageId])
}
